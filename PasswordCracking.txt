# Step 1. Export datatable from ntds.dit
esedbexport -T datatable ntds.dit

# Step 2. Extract hashes from datatable. Use dsdump.py to dump the hashes from the datatable using the bootkey from the SYSTEM hive.
python ~/Applications/Password/ntdsextract/dsusers.py ntds.dit.export/datatable.2  ntds.dit.export/link_table.3 ~/Applications/Password/TEMP --passwordhashes --passwordhistory --lmoutfile LMophc.out --ntoutfile ~/Applications/Password/NTophc.out --pwdformat ophc --syshive SYSTEM

python ~/Applications/Password/ntdsextract/dsusers.py ntds.dit.export/datatable.2  ntds.dit.export/link_table.3 ~/Applications/Password/TEMP --passwordhashes --passwordhistory --lmoutfile LMjohn.out --ntoutfile ~/Applications/Password/NTjohn.out --pwdformat john --syshive SYSTEM

python ~/Applications/Password/ntdsextract/dsusers.py datatable.3  link_table.5 ~/Applications/Password/TEMP --passwordhashes --passwordhistory --lmoutfile LMocl.out --ntoutfile ~/Applications/Password/NTocl.out --pwdformat ocl --syshive SYSTEM




# ImpDump alternative to esedbexport
esentutl.py ntds.dit export -table datatable | grep -E "ATTk590689|ATTm3|ATTm590045|ATTr589970|ATTk589914|ATTk589879|ATTk589984|ATTk589918" > output
python /home/timmy/Applications/Password/ImpDump/impdump.py SYSTEM output > hashes.txt
python /home/timmy/Applications/Password/ImpDump/impdump.py SYSTEM output -history > hash_history.txt


----------------------------------------------------------------------------------------------------------------
# Identify KRBTGT account info (including the key version number – tracks password changes) for every domain in the AD forest. (Run on DC only)
# Powershell

import-module activedirectory
$ADForestRootDomain = (Get-ADForest).RootDomain
$AllADForestDomains = (Get-ADForest).Domains
$ForestKRBTGTInfo = @()
ForEach ($AllADForestDomainsItem in $AllADForestDomains)
{
[string]$DomainDC = (Get-ADDomainController -Discover -Force -Service “PrimaryDC” -DomainName $AllADForestDomainsItem).HostName
[array]$ForestKRBTGTInfo += Get-ADUSer -filter {name -like “krbtgt*”} -Server $DomainDC -Prop Name,Created,logonCount,Modified,PasswordLastSet,PasswordExpired,msDS-KeyVersionNumber,CanonicalName,msDS-KrbTgtLinkBl
}
$ForestKRBTGTInfo | Select Name,Created,logonCount,PasswordLastSet,PasswordExpired,msDS-KeyVersionNumber,CanonicalName | ft -auto



----------------------------------------------------------------------------------------------------------------


./cewl.rb -v -w domain.txt https://www.domain.com/



# Password Crackers commands and formats


# John
sudo ldconfig /usr/local/cuda-7.0/lib64/
~/Applications/Password/john-1.7.9-jumbo-7/run$ ./john --wordlist=/home/user/Applications/Password/Wordlists/massiveWordlist.txt /home/user/Applications/Windows/Responder/logs/*.txt
~/Applications/Password/john-1.7.9-jumbo-7/run $ ./john --format=lm --wordlist=/home/user/Applications/Password/Wordlists/massiveWordlist.txt /home/user/Desktop/Shared/Clients/<client>lanmanJohn.out

./john --fork=2 --devices=0,1 --format=sha512crypt-opencl ~/Applications/Password/Challenge/sha512crypt.txt


# Korelogic rules applied - john-1.8.0-j1-cuda
sudo ./john --fork=6 -w:/home/user/Applications/Password/Wordlists/massiveWordlist.txt --format=netntlmv2 --rules:KoreLogicRulesL33t /home/user/Applications/Windows/Responder/logs/*.txt (1 hr 34 min +)
sudo ./john --fork=6 -w:/home/user/Applications/Password/Wordlists/massiveWordlist.txt --format=netntlmv2 /home/user/Applications/Windows/Responder/logs/*.txt (~1 min)
sudo ./john --fork=6 -w:/home/user/Applications/Password/Wordlists/massiveWordlist.txt --format=netntlmv2 --rules:KoreLogicRulesReplaceLettersCaps /home/user/Applications/Windows/Responder/logs/*.txt (~5 min)

--rules:
KoreLogicRulesL33t
KoreLogicRulesReplaceLettersCaps  (< 1 min)
KoreLogicRulesAppendNumbers_and_Specials_Simple (5hr 45min)



----------------------------------------------------------------------------------------------------------------



# Multiforcer
~/Applications/Password/Cryptohaze-Linux $ ./Cryptohaze-Multiforcer -h NTLM -f test_hashes/Hashes-NTLM-Full.txt -c charsets/charsetall -o results.txt

-------------------------------------------------p---------------------------------------------------------------

# ophcrack
ophcrack

----------------------------------------------------------------------------------------------------------------


!!!!!!!!!Winner!!!!!!!!


./cudaHashcat64.bin -p : -m 1000 -o output.txt -d 1,2 -a 3 ~/Desktop/Shared/Clients/<client>/hashcatNT.txt

./cudaHashcat64.bin -p : -m 1000 -o output.txt -d 1,2 -a 3 -1 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890 ~/Desktop/Shared/Clients/<client>/hashcatNT.txt ?1?1?1?1?1?1?1?1

./cudaHashcat64.bin -m 1000 -p : -show -d 1,2 -a 3 -o NTcracked.txt -1 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\!\@\#\$\&\* NTLMhash.txt ?1?1?1?1?1?1?1?1 --increment (~10 hrs)


./cudaHashcat64.bin -p : -m 1000 -o output.txt -d 1,2 -a 3 -1 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\!\@\#\$\&\* ~/Desktop/Shared/Clients/<client>/hashcat.txt masks/customNTLM.hcmask

#cudaHashcrack64 Lanman

./cudaHashcat64.bin -p : -m 3000 -o output.txt -d 1,2 -a 3 -1 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\!\@\#\$\&\* ~/Desktop/Shared/Clients/<client>/hashcat.txt masks/customLM.hcmask


# NetNTLMv2 - Need seperator to identify hash   **********************
./cudaHashcat64.bin -p : -m 5600 -show -o output.txt -d 1,2 -a 6 -1 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\!\@\#\$\&\* /home/user/Applications/Windows/Responder/name.txt /home/user/Applications/Password/Wordlists/massiveWordlist.txt ?1?1?1?1?1?1?1?1?1?1?1 --increment

./cudaHashcat64.bin -p : -m 5600 -show -o Cracked.txt  --session=name -d 1,2 -a 6 -1 1234567890\!\@\#\$\&\* /home/user/Applications/Windows/Responder/name.txt /home/user/Applications/Password/Wordlists/massiveWordlist.txt ?1?1?1?1 --increment (~17 hrs)

./cudaHashcat64.bin -p : -m 5600 -show -o Cracked.txt  --session=name --restore -d 1,2 -a 3 /home/user/Applications/Windows/Responder/Hashes.txt ?u?l?l?l?l?l?d?d (~20 hrs)

###*** Straight Dictionary attack 
./cudaHashcat64.bin -p : -m 5600 -show -o Cracked.txt  --session=name -d 1,2 -a 0 /home/user/Applications/Windows/Responder/Hashes.txt /home/user/Applications/Password/Wordlists/massiveWordlist.txt

###*** Hybrid attack
./cudaHashcat64.bin -p : -m 5600 -show -o Cracked.txt  --session=name -d 1,2 -a 6 -1 \!\@\#\$\&\* /home/user/Applications/Windows/Responder/Hashes.txt /home/user/Applications/Password/Wordlists/massiveWordlist.txt ?d?d?d?1 --increment (~1m, ~8m, ~1.25hr, ~12hrs,) - ****cracked 7 of 41 in 7 min**** 



### Hashcat Table-attack for cudaHashcat

./hashcat-cli -a 5 --table-file name.table --stdout | ./cudaHashcat64.bin 






************* May not need ***********************
# Merge cudaHashcat pot file with origional *NTLM* hash dump w/ usernames. Requires spaces as column separators.
awk -F" " 'BEGIN { OFS = FS } NR == FNR { val[$2] = $1; next } $1 in val { $(NF + 1) = val[$1]; print }' <hashfileWusernames> <hashfileWpasswords>

# Strip out : and everything before it.
sed 's/.*://'

